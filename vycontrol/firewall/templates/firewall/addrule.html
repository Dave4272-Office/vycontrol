{% extends "base.html" %}

{% block header_title %}Firewall {{firewall_name}}{% endblock %}
{% block section_title %}<a href="{% url 'firewall:show' firewall_name %}">Firewall {{firewall_name}}</a> - create new rule{% endblock %}
{% block username %}{{ username }}{% endblock %}

{% block debug %}

{{ firewall_name }}

{{ services }}

{{ services_common }}

{{ firewall_networkgroup }}

{{ firewall_addressgroup }}


{% endblock %}

{% block content %}

{% comment %}
<script type="text/javascript">
    var firewall_networkgroup_data = '{{firewall_networkgroup_js|safe}}';
    console.log(firewall_networkgroup_data);

    var firewall_addressgroup_data = '{{firewall_addressgroup_js|safe}}';
    console.log(firewall_addressgroup_data);    

    var netservices_js = '{{netservices_js|safe}}';
    console.log(netservices_js);    

</script>
{% endcomment %}


<p class="submenu1">
    <a href="{% url 'firewall:firewall-list' %}">Firewall List</a> | 

    <a href="{% url 'firewall:firewall-create' %}">Create new firewall</a> | 
    <a href="{% url 'firewall:firewall-addressgroup-list' %}">Address Group</a> | 
    <a href="{% url 'firewall:firewall-networkgroup-list' %}">Network Group</a>
</p>
<p class="submenu2">
    
</p>



<form action="{% url 'firewall:addrule' firewall_name %}" method="post">
    {% csrf_token %}
    

    <h3>Rule Config</h3>

    <div class="container">
        <div class="row">
            <div class="col">
                <p>
                    <label for="alias">rule number</label><br>
                    <input type="text" name="rulenumber" id="rulenumber" value="{{ rulenumber }}" size="5">
                </p>
            </div>

            <div class="col">
                <p>
                    <label for="status">status</label><br>
                    <input type="radio" name="status" id="status" value="enabled"> enabled
                    <input type="radio" name="status" id="status" value="disabled"> disabled
                </p>
            </div>         

            <div class="col">
                <p>
                    <label for="action">action</label><br>
                    <input type="radio" name="action" id="action" value="accept"> accept
                    <input type="radio" name="action" id="action" value="drop"> drop
                    <input type="radio" name="action" id="action" value="reject"> reject        
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <p>
                    <label for="alias">description</label><br>
                    <input type="text" name="description" id="description" value="{{ description }}" size="60">
                </p>
            </div>


        </div>       
    </div>


    <h3><input type="checkbox" id="criteria_protocol" value="1"> Matching criteria - protocol</h3>
    <div class="container" id="criteria_protocol_block" style="display: none">

        <div class="row">

            <div class="col">
                <p>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_all" value="1"> all protocols<br>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_tcp" value="1"> tcp<br>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_udp" value="1"> udp<br>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_tcp_udp" value="1"> tcp and udp<br>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_icmp" value="1"> icmp<br>
                    <input type="radio" class="protocol_criteria" name="protocol_criteria" id="protocol_criteria_other" value="1"> other  
                </p>


            </div>

            <div class="col">
                

                <p id="protocol_custom_block" style="display: none">
                    <label for="protocol_custom">add other protocol</label><br>
                    <input type="text" name="protocol_custom" id="protocol_custom" value="{{ protocol_custom }}" size="5"> 
                    <input type="button" name="destinationport_custom_add" value="add" />
                </p>                     
                    

                <p>
                    <input type="checkbox" name="protocols_negate" id="protocols_negate" value="1">
                    <label for="protocols_negate">negate </label>
                </p>
            </div>
        </div>
    </div>

    <h3><input type="checkbox" id="criteria_port" value="1"> Matching criteria - port</h3>
    <div class="container" id="criteria_port_block" style="display: none">
        <div class="row">  
            <div class="col">

                
                <p>
                    <label for="destinationport">destination ports filtered (click to remove)</label><br>
                    <select name="destinationport" size="10" style="width: 200px;">
                    </select>
                </p>

                <p>
                    <label for="destinationport_common">common destinations ports to add</label><br>
                    <select name="destinationport_common" size="1">
                        {% for p in services_common %}
                        <option>{{ p }} - {{ services|get_item_port:p }} </option>
                        {% endfor %}
                    </select>

                    <input type="checkbox" name="destinationport_common_negate" id="destinationport_common_negate" value="1">
                    <label for="destinationport_common_negate">negate </label>
                    <input type="button" name="destinationport_common_add" value="add" />
                </p>


                <p>
                    <label for="destinationport_custom">add custom destination ports (use single 100 or range 100-200)</label><br>
                    <input type="text" name="destinationport_custom" id="destinationport_custom" value="{{ destinationport_custom }}" size="14"> 
                    <input type="checkbox" name="destinationport_custom_negate" id="destinationport_custom_negate" value="1"> 
                    <label for="destinationport_custom_negate">negate </label>
                    <input type="button" name="destinationport_custom_add" value="add" />
                </p>                     
                    

            </div>
          
            <div class="col">
                <p>
                    <label for="sourceport">common source filtered (click to remove)</label><br>
                    <select name="sourceport" size="10" style="width: 200px;">
                    </select>
                </p>

                <p>
                    <label for="sourceport_common">common source ports to add</label><br>
                    <select name="sourceport_common" size="1">
                        {% for p in services_common %}
                        <option>{{ p }} - {{ services|get_item_port:p }} </option>
                        {% endfor %}
                    </select>

                    <input type="checkbox" name="sourceport_common_negate" id="sourceport_common_negate" value="1">
                    <label for="sourceport_common_negate">negate </label>
                    <input type="button" name="sourceport_common_add" value="add" />
                </p>   

                <p>
                    <label for="sourceport_custom">add custom destination ports (use single 100 or range 100-200)</label><br>
                    <input type="text" name="sourceport_custom" id="sourceport_custom" value="{{ destinationport_custom }}" size="14"> 
                    <input type="checkbox" name="sourceport_custom_negate" id="sourceport_custom_negate" value="1"> 
                    <label for="sourceport_custom_negate">negate </label>
                    <input type="button" name="sourceport_custom_add" value="add" />
                </p>       
               
                
            </div>
        </div>

    </div>


    <!--
    <h3>Matching criteria</h3>

    <div class="container">
        <div class="row">
            <div class="col">
                <p>
                    <input type="radio" name="matching" id="sdaddress" value="sdaddress"> source address / destination address<br>
                    <input type="radio" name="matching" id="smac" value="smac"> source mac-address<br>
                    <input type="radio" name="matching" id="sdaddressgroup" value="sdaddressgroup"> source group address-group  / destination group address-group<br>
                    <input type="radio" name="matching" id="adnetworkgroup" value="adnetworkgroup"> source group network-group / destination group network-group<br>
                    <input type="radio" name="matching" id="sdportgroup" value="sdportgroup"> source group port-group / destination group port-group        
                </p>

            </div>
        </div>
    </div>
    -->

    <h3><input type="checkbox" id="criteria_address" value="1"> Matching criteria - address</h3>
    <div class="container" id="criteria_address_block" style="display: none">


        <div class="row">
            <div class="col">    
                <h4>Valid address examples</h4>
            </div>
        </div>
 
        <div class="row">
            <div class="col">
                <dl>
                    <dt>address</dt>
                    <dd>1.1.1.1</dd>
                </dl>
            </div>

            <div class="col">
                <dl>
                    <dt>address range</dt>
                    <dd>1.1.1.1-1.1.1.10</dd>
                </dl>
            </div>
            
            <div class="col">
                <dl>
                    <dt>CIDR</dt>
                    <dd>1.1.1.0/24</dd>   
                </dl>
            </div>
            
        </div>
    
        <div class="row">
            <div class="col">
                <p>
                    <label for="sdaddress_source">source address</label><br>
                    <input type="text" name="sdaddress_source" id="sdaddress_source" value="" size="30">
                </p>

                <p>
                    <input type="checkbox" name="sdaddress_source_negate" id="sdaddress_source_negate" value="1"> <label for="sdaddress_source_negate">negate source address</label>
                </p>         

            </div>

            <div class="col">
                <p>
                    <label for="sdaddress_destination">destination address</label><br>
                    <input type="text" name="sdaddress_destination" id="sdaddress_destination" value="" size="30">
                </p>

                <p>
                    <input type="checkbox" name="sdaddress_destination_negate" id="sdaddress_destination_negate" value="1"> <label for="sdaddress_destination_negate">negate destination address</label>
                </p>         

          </div>
        </div>

    </div> 
  
    
    <h3><input type="checkbox" id="criteria_addressgroup" value="1"> Matching criteria - address-group</h3>
    <div class="container" id="criteria_addressgroup_block" style="display: none">    

        <div class="row">
            <div class="col">
                <p>
                    <label for="sdaddressgroup_source">source address-group</label><br>
                    <select name="sdaddressgroup_source" size="10">
                        {% for f in firewall_addressgroup %}
                        <option>{{ f }}</option>
                        {% endfor %}      
                    </select>
                </p>

            </div>

            <div class="col">
                <p>
                    <label for="sdaddressgroup_destination">destination address-group</label><br>
                    <select name="sdaddressgroup_destination" size="10">
                        {% for f in firewall_addressgroup %}
                        <option>{{ f }}</option>
                        {% endfor %}        
                    </select>
                </p>


          </div>
        </div>

    </div>


    <h3><input type="checkbox" id="criteria_networkgroup" value="1"> Matching criteria - network-group</h3>
    <div class="container" id="criteria_networkgroup_block" style="display: none">
        <div class="row">
            <div class="col">
                <p>
                    <label for="sdnetworkgroup_source">source network-group</label><br>
                    <select name="sdnetworkgroup_source" size="10">
                        {% for f in firewall_networkgroup %}
                        <option>{{ f }}</option>
                        {% endfor %}
                    </select>
                </p>         
                
            </div>

            <div class="col">
                <p>
                    <label for="sdnetworkgroup_destination">destination network-group</label><br>
                    <select name="sdnetworkgroup_destination" size="10">
                        {% for f in firewall_networkgroup %}
                        <option>{{ f }}</option>
                        {% endfor %}
                    </select>
                </p>


          </div>
        </div>

    </div>    

    <h3><input type="checkbox" id="criteria_portgroup" value="1"> Matching criteria - port group</h3>
    <div class="container" id="criteria_portgroup_block" style="display: none">
        <div class="row">
            <div class="col">
                <p>
                    <label for="sdportgroup_source">source port group</label><br>
                    <select name="sdportgroup_source" size="10">
                        <option>http - 80</option>
                        <option>https - 443</option>
                        <option>smtp - 25</option>
                        <option>ssh - 22</option>
                    </select>
                </p>

            </div>

            <div class="col">
                <p>
                    <label for="sdportgroup_destination">destination port group</label><br>
                    <select name="sdportgroup_destination" size="10">
                        <option>http - 80</option>
                        <option>https - 443</option>
                        <option>smtp - 25</option>
                        <option>ssh - 22</option>
                    </select>
                </p>


          </div>
        </div>

    </div>    


    <h3><input type="checkbox" id="criteria_sourcemac" value="1"> Matching criteria - source mac address</h3>  
    <div class="container" id="criteria_sourcemac_block" style="display: none">
        <div class="row">
            <div class="col">
                <p>
                    <label for="smac_source">mac address</label><br>
                    <input type="text" name="smac_source" id="smac_source" value="" size="30">
                </p>

                <p>
                    <input type="checkbox" name="smac_source_negate" id="smac_source_negate" value="1"> <label for="smac_source_negate">negate source mac address</label>
                </p>                         
            </div>

        </div>

    </div>

    <h3><input type="checkbox" id="criteria_tcpflags" value="1"> Matching criteria - TCP Flags</h3>  
    <div class="container" id="criteria_tcpflags_block" style="display: none">
        <div class="row">
            <div class="col">
                <table width="100%">
                    <tr>
                        <th>Allow flag</th>
                        <th>Negate flag</th>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="SYN"> SYN</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!SYN"> !SYN</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="ACK"> ACK</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!ACK"> !ACK</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="FIN"> FIN</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!FIN"> !FIN</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="RST"> RST</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!RST"> !RST</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="URG"> URG</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!URG"> !URG</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="PSH"> PSH</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!PSH"> !PSH</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="ALL"> ALL</td>
                        <td><input type="checkbox" name="tcpflags" id="tcpflags" value="!ALL"> !ALL</td>
                    </tr>                        
                </table>
            </div>

        </div>
    </div>


    <h3><input type="checkbox" id="criteria_packetstate" value="1"> Matching criteria - Packet State</h3>  
    <div class="container" id="criteria_packetstate_block" style="display: none">
        <div class="row">
            <div class="col">
                <p>
                    <input type="checkbox" name="state" id="state_established" value="established"> established
                    <input type="checkbox" name="state" id="state_invalid" value="invalid"> invalid
                    <input type="checkbox" name="state" id="state_new" value="new"> new
                    <input type="checkbox" name="state" id="state_releated" value="releated"> releated        
                </p>
            </div>

        </div>            
    </div>
    
    <input type="submit" value="Add Rule">
    </form>

    
<script>
    $(document).ready(function () {                            
        $(".protocol_criteria").change(function () {
            if ($("#protocol_criteria_other").is(":checked")) {
                $('#protocol_custom_block').show();
            }
            else if ($("#addresstype_range").not(":checked")) {
                $('#protocol_custom_block').hide();
            }
        });

        $("#criteria_protocol").change(function () {
            if ($("#criteria_protocol").is(":checked")) {
                $('#criteria_protocol_block').show();
            }
            else if ($("#criteria_protocol").not(":checked")) {
                $('#criteria_protocol_block').hide();
            }
        });

        $("#criteria_port").change(function () {
            if ($("#criteria_port").is(":checked")) {
                $('#criteria_port_block').show();
            }
            else if ($("#criteria_port").not(":checked")) {
                $('#criteria_port_block').hide();
            }
        });  

        $("#criteria_address").change(function () {
            if ($("#criteria_address").is(":checked")) {
                $('#criteria_address_block').show();
            }
            else if ($("#criteria_address").not(":checked")) {
                $('#criteria_address_block').hide();
            }
        });    

        $("#criteria_addressgroup").change(function () {
            if ($("#criteria_addressgroup").is(":checked")) {
                $('#criteria_addressgroup_block').show();
            }
            else if ($("#criteria_addressgroup").not(":checked")) {
                $('#criteria_addressgroup_block').hide();
            }
        });    

        $("#criteria_networkgroup").change(function () {
            if ($("#criteria_networkgroup").is(":checked")) {
                $('#criteria_networkgroup_block').show();
            }
            else if ($("#criteria_networkgroup").not(":checked")) {
                $('#criteria_networkgroup_block').hide();
            }
        });   

        $("#criteria_portgroup").change(function () {
            if ($("#criteria_portgroup").is(":checked")) {
                $('#criteria_portgroup_block').show();
            }
            else if ($("#criteria_portgroup").not(":checked")) {
                $('#criteria_portgroup_block').hide();
            }
        });                                        


        $("#criteria_sourcemac").change(function () {
            if ($("#criteria_sourcemac").is(":checked")) {
                $('#criteria_sourcemac_block').show();
            }
            else if ($("#criteria_sourcemac").not(":checked")) {
                $('#criteria_sourcemac_block').hide();
            }
        });     

        $("#criteria_tcpflags").change(function () {
            if ($("#criteria_tcpflags").is(":checked")) {
                $('#criteria_tcpflags_block').show();
            }
            else if ($("#criteria_tcpflags").not(":checked")) {
                $('#criteria_tcpflags_block').hide();
            }
        });


        $("#criteria_packetstate").change(function () {
            if ($("#criteria_packetstate").is(":checked")) {
                $('#criteria_packetstate_block').show();
            }
            else if ($("#criteria_packetstate").not(":checked")) {
                $('#criteria_packetstate_block').hide();
            }
        });                                                        

           
                     
        

    });
</script>
          


{% endblock %}



